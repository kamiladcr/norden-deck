<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>norden-deck</title>
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    <link
      href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      #deck-container {
        width: 100vw;
        height: 100vh;
      }

      #deck-container canvas {
        z-index: 1;
        background: none;
      }

      .deck-widget {
        --button-size: 48px;
      }
    </style>
  </head>

  <body>
    <div id="deck-container"></div>
  </body>

  <script>
    const {
      DeckGL,
      MapView,
      ColumnLayer,
      PolygonLayer,
      CompassWidget,
      ZoomWidget,
      FullscreenWidget,
    } = deck;

    const polygon_layer = new PolygonLayer({
      id: "PolygonLayer",
      data: "layers/polygon_layer.json",
      pickable: false,
      getPolygon: (d) => d,
      filled: false,
      getLineColor: [211, 211, 211, 255],
      lineWidthMinPixels: 1,
    });

    const column_layer = new ColumnLayer({
      id: "ColumnLayer",
      data: "layers/column_layer.json",
      extruded: true,
      radius: 500,
      elevationScale: 6,
      pickable: true,
      autoHighlight: true,
      getPosition: (d) => [d.lng, d.lat],
      getElevation: (d) => d.population,
      getElevationWeight: (d) => d.population,
      getFillColor: (d) => d.fill_color,
      highlightColor: [130, 40, 50, 255],
    });

    function getTooltip({ object }) {
      return (
        object && {
          html: `${object.population} <br><b>${object.munname}</b>`,
          style: {
            background: "white",
            color: "black",
            "font-family": '"Helvetica Neue", Arial',
            "font-size": "10px",
          },
        }
      );
    }

    const deckgl = new DeckGL({
      container: "deck-container",
      map: maplibregl,
      mapStyle: "https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",
      initialViewState: {
        bearing: 0,
        latitude: 59.9,
        longitude: 10.7,
        maxZoom: 15,
        minZoom: 4,
        pitch: 50.5,
        zoom: 6,
      },
      views: [
        new MapView({
          id: "map",
          controller: true,
        }),
      ],
      layers: [polygon_layer, column_layer],
      widgets: [
        new CompassWidget({
          id: "compass",
          viewId: "map",
        }),
        new ZoomWidget({
          id: "zoom",
          viewId: "map",
        }),
        new FullscreenWidget({
          id: "fullscreen",
          viewId: "map",
          placement: "top-right",
        }),
      ],
      getTooltip,
    });
  </script>
</html>
